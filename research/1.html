<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片点击放大镜示例</title>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            text-align: center;
        }

        /* 容器设置相对定位，以便放大镜能正确地相对图片定位 */
        .image-container {
            position: relative;
            /* 确保居中对齐 */
            text-align: center;
            display: inline-block; /* 确保容器只包裹内容 */
        }

        /* 放大镜的样式 */
        .magnifier-glass {
            /* 放大镜本身是一个圆形的区域 */
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: 5px solid #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            cursor: none; /* 隐藏鼠标指针，只显示放大镜 */
            
            /* 关键：放大图片并显示其局部 */
            background-repeat: no-repeat;
            /* 绝对定位，以便跟随鼠标 */
            position: absolute;
            /* 初始隐藏 */
            display: none; 
            /* 确保放大镜在图片上方 */
            z-index: 9999;
            /* 移除可能影响定位的背景色 */
            background-color: transparent; 
        }

        /* 确保显示的图片不会被放大镜遮挡定位 */
        #teaser {
            display: block;
            margin: 0 auto;
            cursor: pointer; /* 提示用户可以点击 */
        }
    </style>
</head>
<body>

    <h1>点击图片开启/关闭放大镜</h1>

    <div align="center" class="image-container">
        <img id="teaser" width="75%" src="cover.png" alt="cover." onclick="toggleMagnifier()">
        
        <div id="magnifier" class="magnifier-glass" style="display: none;"></div>
    </div>

    <img id="large-img-source" src="cover.png" style="display: none;"> 
    
    <p>（点击上方的图片来开启/关闭放大镜功能）</p>

    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            // 获取 DOM 元素
            const teaserImg = document.getElementById('teaser');
            const magnifierGlass = document.getElementById('magnifier');
            const largeImgSource = document.getElementById('large-img-source');

            // 放大镜开关状态
            let isMagnifierActive = false;
            let magnifyRatio = 2; // 放大倍数，可以调整，例如 2.5 或 3

            // --- 核心函数：切换放大镜状态 ---
            window.toggleMagnifier = function() {
                isMagnifierActive = !isMagnifierActive; // 切换状态

                if (isMagnifierActive) {
                    // 开启：显示放大镜
                    magnifierGlass.style.display = 'block';
                    
                    // 绑定鼠标移动事件
                    teaserImg.addEventListener('mousemove', moveMagnifier);
                    // 绑定鼠标移出事件（要求离开图片区域时关闭）
                    teaserImg.addEventListener('mouseleave', deactivateMagnifier);

                    // 初始化背景图（必须在图片加载完成后执行）
                    if (largeImgSource.complete) {
                        setupMagnifier();
                    } else {
                        largeImgSource.onload = setupMagnifier;
                    }

                } else {
                    // 关闭：隐藏放大镜
                    deactivateMagnifier();
                }
            }

            // --- 辅助函数：设置放大镜的背景 ---
            function setupMagnifier() {
                // 设置放大镜的背景图片为高分辨率源图
                magnifierGlass.style.backgroundImage = `url('${largeImgSource.src}')`;
                
                // 确保图片加载成功，并且有尺寸
                if (teaserImg.offsetWidth === 0 || largeImgSource.naturalWidth === 0) {
                     console.error("图片尚未加载或尺寸为零，无法计算放大镜参数。");
                     return;
                }

                // 计算放大镜的尺寸
                const glassSize = magnifierGlass.offsetWidth; 
                
                // 设置放大倍数，并根据倍数调整背景大小
                // 背景尺寸 = 显示图片尺寸 * 放大倍数
                const bgSizeW = teaserImg.offsetWidth * magnifyRatio;
                const bgSizeH = teaserImg.offsetHeight * magnifyRatio;
                magnifierGlass.style.backgroundSize = `${bgSizeW}px ${bgSizeH}px`;
            }

            // --- 辅助函数：鼠标移动时移动放大镜 ---
            function moveMagnifier(e) {
                if (!isMagnifierActive) return;

                // 1. 获取鼠标在图片上的相对位置 (0 ~ 1)
                const imgRect = teaserImg.getBoundingClientRect();
                // clientX/Y 是视口坐标，需要减去图片左上角的坐标，再加上滚动距离 (window.scrollX/Y)
                let x = e.clientX - imgRect.left;
                let y = e.clientY - imgRect.top;

                // 限制鼠标位置在图片内部，以防计算出错
                x = Math.max(0, Math.min(x, teaserImg.offsetWidth));
                y = Math.max(0, Math.min(y, teaserImg.offsetHeight));

                // 2. 计算放大镜容器的位置（使其中心位于鼠标位置）
                const glassSize = magnifierGlass.offsetWidth;
                let glassX = x + imgRect.left + window.scrollX - glassSize / 2;
                let glassY = y + imgRect.top + window.scrollY - glassSize / 2;

                // 定位放大镜容器 (使用 fixed 定位更流畅，这里使用绝对定位，相对于父容器)
                magnifierGlass.style.left = `${x - glassSize / 2}px`;
                magnifierGlass.style.top = `${y - glassSize / 2}px`;


                // 3. 计算背景图的偏移量（实现“放大”效果）
                // 偏移量 = 相对位置 * 放大倍数 - (放大镜尺寸 / 2)
                let bgX = x * magnifyRatio - glassSize / 2;
                let bgY = y * magnifyRatio - glassSize / 2;

                // 设置背景图位置
                magnifierGlass.style.backgroundPosition = `-${bgX}px -${bgY}px`;
            }

            // --- 辅助函数：鼠标移出时关闭放大镜 ---
            function deactivateMagnifier() {
                // 隐藏放大镜
                magnifierGlass.style.display = 'none';
                
                // 必须取消绑定事件，防止重复触发
                teaserImg.removeEventListener('mousemove', moveMagnifier);
                teaserImg.removeEventListener('mouseleave', deactivateMagnifier);
                
                // 将状态设为关闭
                isMagnifierActive = false;
            }
        });
    </script>
</body>
</html>